import React, { useState, useEffect } from "react";

const morphemes = [
  { morpheme: "bio", meaning: "life" },
  { morpheme: "geo", meaning: "earth" },
  { morpheme: "aqua", meaning: "water" },
  { morpheme: "tele", meaning: "far" },
  { morpheme: "micro", meaning: "small" },
  { morpheme: "chrono", meaning: "time" },
  // … add more up to 80
];

export default function App() {
  const [currentMorpheme, setCurrentMorpheme] = useState(null);
  const [submittedWord, setSubmittedWord] = useState("");
  const [correctCount, setCorrectCount] = useState(0);
  const [strikes, setStrikes] = useState(0);
  const [roundTime, setRoundTime] = useState(300); // 5 min
  const [circleTime, setCircleTime] = useState(30); // 30 sec
  const [gameOver, setGameOver] = useState(false);

  // initialize morpheme
  useEffect(() => {
    getRandomMorpheme();
  }, []);

  // 5-minute timer
  useEffect(() => {
    if (gameOver) return;
    const roundTimer = setInterval(() => {
      setRoundTime((prev) => {
        if (prev <= 1) {
          clearInterval(roundTimer);
          setGameOver(true);
          return 0;
        }
        return prev - 1;
      });
    }, 1000);
    return () => clearInterval(roundTimer);
  }, [gameOver]);

  // 30-second timer
  useEffect(() => {
    if (gameOver) return;
    const circleTimer = setInterval(() => {
      setCircleTime((prev) => {
        if (prev <= 1) {
          setStrikes((s) => s + 1);
          getRandomMorpheme();
          return 30;
        }
        return prev - 1;
      });
    }, 1000);
    return () => clearInterval(circleTimer);
  }, [gameOver]);

  const getRandomMorpheme = () => {
    const random = morphemes[Math.floor(Math.random() * morphemes.length)];
    setCurrentMorpheme(random);
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (gameOver) return;
    if (submittedWord.toLowerCase().includes(currentMorpheme.morpheme)) {
      setCorrectCount((c) => {
        if (c + 1 === 20) setGameOver(true);
        return c + 1;
      });
      getRandomMorpheme();
      setCircleTime(30);
    } else {
      setStrikes((s) => {
        if (s + 1 >= 3) setGameOver(true);
        return s + 1;
      });
    }
    setSubmittedWord("");
  };

  const resetGame = () => {
    setCorrectCount(0);
    setStrikes(0);
    setRoundTime(300);
    setCircleTime(30);
    setGameOver(false);
    getRandomMorpheme();
  };

  return (
    <div className="flex min-h-screen bg-gray-100 text-center">
      {/* Left column */}
      <div className="w-1/4 bg-white p-4 shadow-md">
        <h2 className="text-lg font-semibold">Progress</h2>
        <p className="mt-2">✅ Words: {correctCount}</p>
        <p className="mt-2">❌ Strikes: {"X".repeat(strikes)}</p>
      </div>

      {/* Center column */}
      <div className="flex-1 flex flex-col items-center justify-center">
        <h1 className="text-3xl font-bold mb-6">SayWord: Knockout</h1>

        {/* Card */}
        {currentMorpheme && (
          <div className="bg-white rounded-2xl shadow-lg border-2 border-blue-900 w-64 h-96 flex flex-col items-center justify-center relative">
            <div className="absolute bottom-2 left-2 w-6 h-6 bg-gray-200 text-xs flex items-center justify-center">
              {currentMorpheme.morpheme.length}
            </div>
            <p className="text-3xl font-bold">{currentMorpheme.morpheme}</p>
            <p className="italic text-sm mt-2">{currentMorpheme.meaning}</p>
          </div>
        )}

        {/* Circle timer */}
        <div className="mt-6 w-20 h-20 rounded-full border-4 border-gray-400 flex items-center justify-center text-xl font-bold">
          {circleTime}
        </div>

        {/* Round progress bar */}
        <div className="w-3/4 bg-gray-300 rounded-full h-4 mt-6">
          <div
            className="bg-orange-500 h-4 rounded-full"
            style={{ width: `${(roundTime / 300) * 100}%` }}
          />
        </div>

        {/* Word submission */}
        <form onSubmit={handleSubmit} className="mt-6">
          <input
            type="text"
            className="border p-2 rounded"
            placeholder="Enter a word"
            value={submittedWord}
            onChange={(e) => setSubmittedWord(e.target.value)}
            disabled={gameOver}
          />
          <button
            type="submit"
            className="ml-2 bg-blue-600 text-white px-4 py-2 rounded"
            disabled={gameOver}
          >
            Submit
          </button>
        </form>

        {/* Reset button */}
        {gameOver && (
          <button
            onClick={resetGame}
            className="mt-4 bg-green-600 text-white px-4 py-2 rounded"
          >
            Restart
          </button>
        )}
      </div>
    </div>
  );
}
